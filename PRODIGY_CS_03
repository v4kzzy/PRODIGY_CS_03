import ttkbootstrap as tb
from ttkbootstrap.constants import *
import tkinter as tk

# --- LOGIC FUNCTIONS ---

def caesar_cipher(text, shift, mode):
    result = ""
    # If decrypting, we simply reverse the shift
    if mode == "decrypt":
        shift = -shift

    for char in text:
        if char.isalpha():
            # Determine if uppercase or lowercase base
            base = ord('A') if char.isupper() else ord('a')
            
            # The Math: (Character - Base + Shift) % 26 + Base
            # This wraps the alphabet around (z becomes a)
            new_char = chr((ord(char) - base + shift) % 26 + base)
            result += new_char
        else:
            # Keep numbers and symbols the same
            result += char
    return result

def update_ui(event=None):
    """Refreshes the output whenever you type or slide"""
    text = entry_text.get("1.0", "end-1c") # Get text from input box
    shift = shift_var.get()                # Get number from slider
    mode = mode_var.get()                  # Get "encrypt" or "decrypt"

    # Update the label next to slider
    lbl_shift_num.config(text=str(shift))

    # Calculate result
    encrypted_text = caesar_cipher(text, shift, mode)
    
    # Update Output Box
    output_text.config(state="normal")     # Unlock to edit
    output_text.delete("1.0", "end")       # Clear old text
    output_text.insert("1.0", encrypted_text) # Insert new text
    output_text.config(state="disabled")   # Lock again (Read-only)

def copy_to_clipboard():
    result = output_text.get("1.0", "end-1c")
    app.clipboard_clear()
    app.clipboard_append(result)
    # Flash the button to show it worked
    btn_copy.config(text="Copied!", bootstyle="success")
    app.after(1000, lambda: btn_copy.config(text="Copy Result", bootstyle="info-outline"))

def try_all_shifts():
    """Opens a new window to show all 26 possibilities"""
    bf_window = tb.Toplevel(app)
    bf_window.title("Brute Force Cracker")
    bf_window.geometry("500x600")
    
    lbl = tb.Label(bf_window, text="Trying all 26 keys...", font=("Helvetica", 12), bootstyle="warning")
    lbl.pack(pady=10)

    # Scrollable text area
    txt = tb.Text(bf_window, font=("Consolas", 10))
    txt.pack(fill=BOTH, expand=YES, padx=10, pady=10)
    
    text_to_crack = entry_text.get("1.0", "end-1c")
    
    for s in range(26):
        # Shift backwards to decrypt
        attempt = caesar_cipher(text_to_crack, s, "decrypt")
        txt.insert("end", f"KEY {s:<2} :  {attempt}\n")

def clear_all():
    entry_text.delete("1.0", "end")
    shift_var.set(3)
    update_ui()

# --- UI SETUP ---

app = tb.Window(themename="cyborg")
app.title("Caesar Cipher Pro")
app.geometry("600x680")

# 1. Header
header_frame = tb.Frame(app)
header_frame.pack(pady=20)

tb.Label(header_frame, text="ðŸ” CAESAR CIPHER", font=("Helvetica", 22, "bold"), bootstyle="info").pack()
tb.Label(header_frame, text="Simple Text Encryption", font=("Helvetica", 10), bootstyle="secondary").pack()

# 2. Input Section
input_frame = tb.Labelframe(app, text=" Input Message ", padding=15, bootstyle="primary")
input_frame.pack(fill=X, padx=20, pady=10)

entry_text = tb.Text(input_frame, height=3, font=("Consolas", 11), wrap="word", bd=0)
entry_text.pack(fill=X)
entry_text.bind("<KeyRelease>", update_ui) # Run update_ui whenever a key is pressed

# 3. Controls (Slider & Mode)
control_frame = tb.Frame(app)
control_frame.pack(fill=X, padx=20)

# Slider Box
shift_frame = tb.Labelframe(control_frame, text=" Shift Key ", padding=10, bootstyle="warning")
shift_frame.pack(side=LEFT, fill=BOTH, expand=YES, padx=(0, 10))

lbl_shift_num = tb.Label(shift_frame, text="3", font=("Helvetica", 18, "bold"), bootstyle="warning")
lbl_shift_num.pack(side=RIGHT, padx=10)

shift_var = tk.IntVar(value=3)
shift_scale = tb.Scale(shift_frame, from_=0, to=25, variable=shift_var, command=lambda x: update_ui(), bootstyle="warning")
shift_scale.pack(side=LEFT, fill=X, expand=YES)

# Mode Box
mode_frame = tb.Labelframe(control_frame, text=" Mode ", padding=10, bootstyle="success")
mode_frame.pack(side=RIGHT, fill=BOTH)

mode_var = tk.StringVar(value="encrypt")
chk_mode = tb.Checkbutton(mode_frame, text="Decrypt Mode", variable=mode_var, onvalue="decrypt", offvalue="encrypt", bootstyle="success-round-toggle", command=update_ui)
chk_mode.pack(padx=10, pady=5)

# 4. Output Section
output_frame = tb.Labelframe(app, text=" Result ", padding=15, bootstyle="info")
output_frame.pack(fill=BOTH, expand=YES, padx=20, pady=10)

output_text = tb.Text(output_frame, height=4, font=("Consolas", 12, "bold"), wrap="word", state="disabled", bg="#222", fg="#00bc8c")
output_text.pack(fill=BOTH, expand=YES)

# 5. Buttons
btn_frame = tb.Frame(app, padding=20)
btn_frame.pack(fill=X, side=BOTTOM)

btn_copy = tb.Button(btn_frame, text="Copy Result", bootstyle="info-outline", command=copy_to_clipboard)
btn_copy.pack(side=LEFT, fill=X, expand=YES, padx=5)

btn_brute = tb.Button(btn_frame, text="Crack (Try All)", bootstyle="warning-outline", command=try_all_shifts)
btn_brute.pack(side=LEFT, fill=X, expand=YES, padx=5)

btn_clear = tb.Button(btn_frame, text="Reset", bootstyle="danger-outline", command=clear_all)
btn_clear.pack(side=LEFT, fill=X, expand=YES, padx=5)

# Start the App
app.mainloop()
