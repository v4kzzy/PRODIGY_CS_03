import ttkbootstrap as tb
from ttkbootstrap.constants import *
import re
from tkinter import Canvas

class PasswordStrengthApp(tb.Window):
    def __init__(self):
        super().__init__(themename="cyborg")
        self.title("ShieldPass Pro")
        self.geometry("500x650")
        
        # --- UI LAYOUT ---
        self.create_header()
        self.create_meter_section()
        self.create_input_section()
        self.create_checklist_section()

    def create_header(self):
        """Top title section"""
        header_frame = tb.Frame(self)
        header_frame.pack(pady=20)
        
        # We use a Label with a unicode lock icon as a simple graphical element
        self.lbl_icon = tb.Label(header_frame, text="ðŸ”“", font=("Segoe UI Emoji", 40), bootstyle="danger")
        self.lbl_icon.pack()
        
        title = tb.Label(header_frame, text="Security Audit", font=("Helvetica", 16, "bold"), bootstyle="light")
        title.pack()

    def create_meter_section(self):
        """The visual gauge"""
        self.meter = tb.Meter(
            self,
            bootstyle="danger",
            subtext="Security Level",
            interactive=False,
            textright="%",
            metertype="full", # Full circle looks more like a shield
            stripethickness=15,
            amountused=0,
            subtextfont=("Helvetica", 10),
            textfont=("Helvetica", 20, "bold")
        )
        self.meter.pack(pady=10)

    def create_input_section(self):
        """Password input area"""
        input_frame = tb.Frame(self, padding=20)
        input_frame.pack(fill=X)

        self.entry_pass = tb.Entry(input_frame, show="â€¢", font=("Consolas", 14), bootstyle="dark")
        self.entry_pass.pack(fill=X, pady=5)
        self.entry_pass.bind("<KeyRelease>", self.check_strength)

        # Toggle Show/Hide
        self.var_show = tb.BooleanVar()
        self.chk_show = tb.Checkbutton(
            input_frame, 
            text="Reveal Password", 
            variable=self.var_show, 
            command=self.toggle_show, 
            bootstyle="round-toggle-info"
        )
        self.chk_show.pack(pady=10, anchor="e")

    def create_checklist_section(self):
        """Visual checklist for requirements"""
        self.check_frame = tb.Labelframe(self, text=" Security Requirements ", padding=15, bootstyle="secondary")
        self.check_frame.pack(fill=X, padx=20, pady=10)

        # Create labels for each rule
        self.rules = {
            "length": tb.Label(self.check_frame, text="â—‹ At least 8 characters", bootstyle="secondary"),
            "upper": tb.Label(self.check_frame, text="â—‹ Uppercase letter (A-Z)", bootstyle="secondary"),
            "lower": tb.Label(self.check_frame, text="â—‹ Lowercase letter (a-z)", bootstyle="secondary"),
            "digit": tb.Label(self.check_frame, text="â—‹ Number (0-9)", bootstyle="secondary"),
            "special": tb.Label(self.check_frame, text="â—‹ Special Symbol (!@#$)", bootstyle="secondary"),
        }
        
        for lbl in self.rules.values():
            lbl.pack(anchor="w", pady=2)

    # --- LOGIC ---

    def toggle_show(self):
        if self.var_show.get():
            self.entry_pass.config(show="")
        else:
            self.entry_pass.config(show="â€¢")

    def update_rule(self, key, satisfied):
        """Updates the color/icon of a checklist item"""
        lbl = self.rules[key]
        if satisfied:
            lbl.config(text="âœ“ " + lbl.cget("text")[2:], bootstyle="success")
        else:
            lbl.config(text="â—‹ " + lbl.cget("text")[2:], bootstyle="secondary")

    def check_strength(self, event):
        password = self.entry_pass.get()
        score = 0
        
        # 1. Check Rules
        has_len = len(password) >= 8
        has_upper = bool(re.search(r"[A-Z]", password))
        has_lower = bool(re.search(r"[a-z]", password))
        has_digit = bool(re.search(r"\d", password))
        has_spec = bool(re.search(r"[!@#$%^&*(),.?\":{}|<>]", password))

        # Update Checklist UI
        self.update_rule("length", has_len)
        self.update_rule("upper", has_upper)
        self.update_rule("lower", has_lower)
        self.update_rule("digit", has_digit)
        self.update_rule("special", has_spec)

        # Calculate Score
        if has_len: score += 20
        if has_upper: score += 20
        if has_lower: score += 20
        if has_digit: score += 20
        if has_spec: score += 20

        # Update Meter & Icon
        if score < 40:
            color = "danger"
            icon = "ðŸ”“" # Unlocked
        elif score < 80:
            color = "warning"
            icon = "ðŸ”" # Semi-locked
        else:
            color = "success"
            icon = "ðŸ”’" # Locked/Secure

        self.meter.configure(amountused=score, bootstyle=color)
        self.lbl_icon.config(text=icon, bootstyle=color)

if __name__ == "__main__":
    app = PasswordStrengthApp()
    app.mainloop()
